(function(b){b.fn.makeEditable=function(J){function C(c){if(!a.bDisableEditing){var e={event:"dblclick",onsubmit:function(c,e){w=e.revert;sNewCellDisplayValue=v=null;s=n._iDisplayStart;if("text"==c.type||"select"==c.type||"textarea"==c.type){var d=b("input,select,textarea",this);v=b("input,select,textarea",b(this)).val();if(1==d.length){var f=d[0];sNewCellDisplayValue="select"==f.nodeName.toLowerCase()||"select"==f.tagName.toLowerCase()?b("option:selected",f).text():v}if(!a.fnOnEditing(d,c,e.revert,
a.fnGetRowID(b(e.parentNode))))return!1;null!=c.oValidationOptions&&d.parents("form").validate(c.oValidationOptions);null!=c.cssclass&&d.addClass(c.cssclass);return null==c.cssclass&&null==c.oValidationOptions?!0:!d.valid()||0==d.valid()?!1:!0}a.fnStartProcessingMode()},submitdata:function(c,e){var f=a.fnGetRowID(b(this.parentNode)),k=d.fnGetPosition(this)[0],l=d.fnGetPosition(this)[1],h=d.fnGetPosition(this)[2],m=d.fnSettings().aoColumns[h].sName;if(null==m||""==m)m=d.fnSettings().aoColumns[h].sTitle;
var g=null;return g=null==a.aoColumns||null==a.aoColumns[h]?b.extend({},a.oUpdateParameters,{id:f,rowId:k,columnPosition:l,columnId:h,columnName:m}):b.extend({},a.oUpdateParameters,a.aoColumns[h].oUpdateParameters,{id:f,rowId:k,columnPosition:l,columnId:h,columnName:m})},callback:function(c,e){a.fnEndProcessingMode();var f="",k=d.fnGetPosition(this),f=!n.oFeatures.bServerSide;b("td.last-updated-cell",d.fnGetNodes()).removeClass("last-updated-cell");-1<c.indexOf(a.sFailureResponsePrefix)?(d.fnUpdate(w,
k[0],k[2],f),b("td.last-updated-cell",d).removeClass("last-updated-cell"),b(this).addClass("last-updated-cell"),a.fnShowError(c.replace(a.sFailureResponsePrefix,"").trim(),"update"),f="failure"):"IGNORE"==a.sSuccessResponse||null!=a.aoColumns&&null!=a.aoColumns[k[2]]&&"IGNORE"==a.aoColumns[k[2]].sSuccessResponse||null==v||v==c||a.sSuccessResponse==c?(null==sNewCellDisplayValue?d.fnUpdate(c,k[0],k[2],f):d.fnUpdate(sNewCellDisplayValue,k[0],k[2],f),b("td.last-updated-cell",d).removeClass("last-updated-cell"),
b(this).addClass("last-updated-cell"),f="success"):(d.fnUpdate(w,k[0],k[2],f),a.fnShowError(c,"update"),f="failure");a.fnOnEdited(f,w,sNewCellDisplayValue,k[0],k[1],k[2]);null!=e.fnOnCellUpdated&&e.fnOnCellUpdated(f,c,k[0],k[2],e);x();if(a.bUseKeyTable){var h=d.keys;setTimeout(function(){h.block=!1},0)}},onerror:function(){a.fnEndProcessingMode();a.fnShowError("Cell cannot be updated","update");a.fnOnEdited("failure")},onreset:function(){if(a.bUseKeyTable){var b=d.keys;setTimeout(function(){b.block=
!1},0)}},height:a.sEditorHeight,width:a.sEditorWidth},f=null;if(null!=a.aoColumns)for(var h=0,l=0;h<n.aoColumns.length;h++){if(n.aoColumns[h].bVisible)if(null==a.aoColumns[l])l++;else{var f=b("td:nth-child("+(l+1)+")",c),m=e,m=b.extend({},e,a.oEditableSettings,a.aoColumns[l]);l++;var k=a.sUpdateURL;try{null!=m.sUpdateURL&&(k=m.sUpdateURL)}catch(g){}f.each(function(){b(this).hasClass(a.sReadOnlyCellClass)||b(this).editable(k,m)})}}else f=b("td:not(."+a.sReadOnlyCellClass+")",c),f.editable(a.sUpdateURL,
b.extend({},e,a.oEditableSettings))}}function y(c){if(a.fnOnAdding()&&g.valid())if(s=n._iDisplayStart,a.fnStartProcessingMode(),a.bUseFormsPlugin)b(g).ajaxSubmit({dataType:"xml",success:function(b,c,e){-1!=e.responseText.toLowerCase().indexOf("error")?(a.fnEndProcessingMode(),a.fnShowError(e.responseText.replace("Error",""),"add"),a.fnOnAdded("failure")):E(e.responseText)},error:function(b){a.fnEndProcessingMode();a.fnShowError(b.responseText,"add");a.fnOnAdded("failure")}});else{var e=g.serialize();
b.ajax({url:a.sAddURL,data:e,type:a.sAddHttpMethod,dataType:a.sAddDataType,success:E,error:function(b){a.fnEndProcessingMode();a.fnShowError(b.responseText,"add");a.fnOnAdded("failure")}})}c.stopPropagation();c.preventDefault()}function E(c){a.fnEndProcessingMode();if(a.fnOnNewRowPosted(c)){var e=d.fnSettings();if(!e.oFeatures.bServerSide){jQuery.data(g,"DT_RowId",c);var f=F(g),e=null!=e.aoColumns&&isNaN(parseInt(e.aoColumns[0].mDataProp))?d.fnAddData(rowData):d.fnAddData(f),e=d.fnGetNodes(e);a.fnSetRowID(b(e),
c,!0);C(e);b("tr.last-added-row",d).removeClass("last-added-row");b(e).addClass("last-added-row")}g.dialog("close");b(g)[0].reset();b(".error",b(g)).html("");x();a.fnOnAdded("success");if(a.bUseKeyTable){var h=d.keys;setTimeout(function(){h.block=!1},0)}}}function G(a){b(g).validate().resetForm();b(g)[0].reset();b(".error",b(g)).html("");b(".error",b(g)).hide();g.dialog("close");a.stopPropagation();a.preventDefault()}function z(){a.bUseKeyTable||(null!=a.oDeleteRowButtonOptions?p.button("option",
"disabled",!0):p.attr("disabled","true"))}function K(c){var e=b(this).attr("href");if(null==e||""==e)e=a.sDeleteURL;c.preventDefault();c.stopPropagation();s=n._iDisplayStart;r=b(this).parents("td")[0];jSelectedRow=b(this).parents("tr");A=jSelectedRow[0];jSelectedRow.addClass(a.sSelectedRowClass);c=a.fnGetRowID(b(r.parentNode));a.fnOnDeleting(jSelectedRow,c,B)&&B(c,e)}function H(c){c.preventDefault();c.stopPropagation();s=n._iDisplayStart;r=A=null;if(a.bUseKeyTable)r=b("td.focus",d)[0];else{if(0==
b("tr."+a.sSelectedRowClass+" td",d).length){_fnDisableDeleteButton();return}r=b("tr."+a.sSelectedRowClass+" td",d)[0]}if(null==r)z();else{a.bUseKeyTable&&(D=d.keys.fnGetCurrentPosition());c=a.fnGetRowID(b(r.parentNode));var e=b(r).parent("tr");A=e[0];a.fnOnDeleting(e,c,B)&&B(c)}}function B(c,e){var f=e;null==e&&(f=a.sDeleteURL);a.fnStartProcessingMode();var d=b.extend(a.oDeleteParameters,{id:c});b.ajax({url:f,type:a.sDeleteHttpMethod,data:d,success:L,dataType:a.sDeleteDataType,error:function(b){a.fnEndProcessingMode();
a.fnShowError(b.responseText,"delete");a.fnOnDeleted("failure")}})}function L(b){a.fnEndProcessingMode();var e=A;b==a.sSuccessResponse||""==b?(d.fnDeleteRow(e),z(),x(),a.bUseKeyTable&&d.keys.fnSetPosition(D[0],D[1]),a.fnOnDeleted("success")):(a.fnShowError(b,"delete"),a.fnOnDeleted("failure"))}function x(){n._iDisplayStart=s;n.oApi._fnCalculateEnd(n);n.oApi._fnDraw(n)}function M(b){a.aoTableAction&&a.fnShowError("Configuration error - aoTableAction setting are not set",b);for(var e=0,e=0;e<a.aoTableActions.length;e++)if(a.aoTableActions[e].sAction==
b)return a.aoTableActions[e];a.fnShowError("Cannot find action configuration settings",b)}function N(c,e){var f=d.fnGetPosition(e),h=a.fnGetRowID(b(e));b(c).validate().resetForm();jQuery.data(b(c)[0],"DT_RowId",h);b("input.DT_RowId",b(c)).val(h);jQuery.data(b(c)[0],"ROWID",f);b("input.ROWID",b(c)).val(f);var l=d.fnSettings().aoColumns.length;b("input:text[rel],input:radio[rel][checked],input:hidden[rel],select[rel],textarea[rel],input:checkbox[rel]",b(c)).each(function(){var c=b(this).attr("rel");
if(c>=l)a.fnShowError("In the form is placed input element with the name '"+b(this).attr("name")+"' with the 'rel' attribute that must be less than a column count - "+l,"action");else if(c=d.fnGetData(e)[c],"select"==this.nodeName.toLowerCase()||"select"==this.tagName.toLowerCase())if(!0==this.multiple){var f=[];aoCellValues=c.split(",");for(i=0;i<=this.options.length-1;i++)-1!=jQuery.inArray(this.options[i].text.toLowerCase().trim(),aoCellValues)&&f.push(this.options[i].value);b(this).val(f)}else for(i=
0;i<=this.options.length-1;i++)this.options[i].text.toLowerCase()==c.toLowerCase()&&b(this).val(this.options[i].value);else"span"==this.nodeName.toLowerCase()||"span"==this.tagName.toLowerCase()?b(this).html(c):"checkbox"==this.type?"true"==c&&b(this).attr("checked",!0):"radio"==this.type?this.value==c&&(this.checked=!0):this.value=c})}function F(c){var e=jQuery.data(c,"DT_RowId"),f=n.aoColumns.length,d=[],l={};b("input:text[rel],input:radio[rel][checked],input:hidden[rel],select[rel],textarea[rel],span.datafield[rel],input:checkbox[rel]",
c).each(function(){var c=b(this).attr("rel"),k="";c>=f?a.fnShowError("In the add form is placed input element with the name '"+b(this).attr("name")+"' with the 'rel' attribute that must be less than a column count - "+f,"add"):(k="select"==this.nodeName.toLowerCase()||"select"==this.tagName.toLowerCase()?b.map(b.makeArray(b("option:selected",this)),function(a,c){return b(a).text()}).join(","):"span"==this.nodeName.toLowerCase()||"span"==this.tagName.toLowerCase()?b(this).html():"checkbox"==this.type?
this.checked?"on"!=this.value?this.value:"true":"on"!=this.value?"":"false":this.value,k=k.replace("DATAROWID",e),k=k.replace(a.sIDToken,e),null!=n.aoColumns&&null!=n.aoColumns[c]&&isNaN(parseInt(n.aoColumns[0].mDataProp))?l[n.aoColumns[c].mDataProp]=k:d[c]=k)});return null!=n.aoColumns&&isNaN(parseInt(n.aoColumns[0].mDataProp))?l:d}function O(c){var e=b(c),f=e.attr("id"),f=f.replace("form",""),d=e.attr("action");a.fnOnBeforeAction(f)&&e.valid()&&(s=n._iDisplayStart,a.fnStartProcessingMode(),a.bUseFormsPlugin?
(d={success:function(b,e,d){a.fnEndProcessingMode();-1!=b.toLowerCase().indexOf("error")||"success"!=e?(a.fnShowError(b,f),a.fnOnActionCompleted("failure")):(I(c),a.fnOnActionCompleted("success"))},error:function(b){a.fnEndProcessingMode();a.fnShowError(b.responseText,f);a.fnOnActionCompleted("failure")}},M(f),d=b.extend({},a.oAjaxSubmitOptions,d),b(oActionForm).ajaxSubmit(d)):(e=e.serialize(),b.ajax({url:d,data:e,type:a.sAddHttpMethod,dataType:a.sAddDataType,success:function(b){a.fnEndProcessingMode();
I(c);a.fnOnActionCompleted("success")},error:function(b){a.fnEndProcessingMode();a.fnShowError(b.responseText,f);a.fnOnActionCompleted("failure")}})))}function I(a){for(var e=F(a),f=jQuery.data(a,"ROWID"),h=d.fnSettings(),g=h.aoColumns.length,m=0;m<g;m++)sCellValue=null!=h.aoColumns&&null!=h.aoColumns[m]&&isNaN(parseInt(h.aoColumns[0].mDataProp))?rowData[h.aoColumns[m].mDataProp]:e[m],void 0!=sCellValue&&d.fnUpdate(sCellValue,f,m);x();b(a).dialog("close")}var s=0,d,q,p,t,u,g,a,w,v,A,r,D,n;d=this;
a=b.extend({sUpdateURL:"UpdateData",sAddURL:"AddData",sDeleteURL:"DeleteData",sAddNewRowFormId:"formAddNewRow",oAddNewRowFormOptions:{autoOpen:!1,modal:!0},sAddNewRowButtonId:"btnAddNewRow",oAddNewRowButtonOptions:null,sAddNewRowOkButtonId:"btnAddNewRowOk",sAddNewRowCancelButtonId:"btnAddNewRowCancel",oAddNewRowOkButtonOptions:{label:"Ok"},oAddNewRowCancelButtonOptions:{label:"Cancel"},sDeleteRowButtonId:"btnDeleteRow",oDeleteRowButtonOptions:null,sSelectedRowClass:"row_selected",sReadOnlyCellClass:"read_only",
sAddDeleteToolbarSelector:".add_delete_toolbar",fnShowError:function(a,b){alert(a)},fnStartProcessingMode:function(){d.fnSettings().oFeatures.bProcessing&&b(".dataTables_processing").css("visibility","visible")},fnEndProcessingMode:function(){d.fnSettings().oFeatures.bProcessing&&b(".dataTables_processing").css("visibility","hidden")},aoColumns:null,fnOnDeleting:function(a,b,d){return confirm("Are you sure that you want to delete this record?")},fnOnDeleted:function(a){},fnOnAdding:function(){return!0},
fnOnNewRowPosted:function(a){return!0},fnOnAdded:function(a){},fnOnEditing:function(a){return!0},fnOnEdited:function(a,b,d,g,l,m){},sAddHttpMethod:"POST",sAddDataType:"text",sDeleteHttpMethod:"POST",sDeleteDataType:"text",fnGetRowID:function(a){return a.attr("id")},fnSetRowID:function(a,b,d){d?a.attr("id",b):(null==a.attr("id")||""==a.attr("id"))&&a.attr("id",b)},sEditorHeight:"100%",sEditorWidth:"100%",bDisableEditing:!1,oDeleteParameters:{},oUpdateParameters:{},sIDToken:"DT_RowId",aoTableActions:null,
fnOnBeforeAction:function(a){return!0},bUseFormsPlugin:!1,fnOnActionCompleted:function(a){},sSuccessResponse:"ok",sFailureResponsePrefix:"ERROR",oKeyTable:null},J);n=d.fnSettings();a.bUseKeyTable=null!=a.oKeyTable;return this.each(function(){var c=d.dataTableSettings[0].sTableId;if(a.bUseKeyTable){var e=new KeyTable({table:document.getElementById(c),datatable:d});d.keys=e;e.event.action(null,null,function(c){b(c).hasClass(a.sReadOnlyCellClass)||(e.block=!0,setTimeout(function(){b(c).dblclick()},0))})}null!=
d.fnSettings().sAjaxSource?d.fnSettings().aoDrawCallback.push({fn:function(){C(d.fnGetNodes());b(d.fnGetNodes()).each(function(){var c=d.fnGetPosition(this),c=d.fnGetData(c)[0];a.fnSetRowID(b(this),c)})},sName:"fnApplyEditable"}):C(d.fnGetNodes());g=b("#"+a.sAddNewRowFormId);if(0!=g.length){c=d.fnSettings().aoColumns.length;for(f=0;f<c;f++)0==b("[rel="+f+"]",g).length&&a.fnShowError("In the form that is used for adding new records cannot be found an input element with rel="+f+" that will be bound to the value in the column "+
f+". See http://code.google.com/p/jquery-datatables-editable/wiki/AddingNewRecords#Add_new_record_form for more details","init");null!=a.oAddNewRowFormOptions?a.oAddNewRowFormOptions.autoOpen=!1:a.oAddNewRowFormOptions={autoOpen:!1};g.dialog(a.oAddNewRowFormOptions);q=b("#"+a.sAddNewRowButtonId);if(0!=q.length)"true"!=q.data("add-event-attached")&&(q.click(function(){g.dialog("open")}),q.data("add-event-attached","true"));else{if(0==b(a.sAddDeleteToolbarSelector).length)throw"Cannot find a button with an id '"+
a.sAddNewRowButtonId+"', or placeholder with an id '"+a.sAddDeleteToolbarSelector+"' that should be used for adding new row although form for adding new record is specified";q=null}"form"==g[0].nodeName.toLowerCase()?(g.unbind("submit"),g.submit(function(a){y(a);return!1})):(b("form",g[0]).unbind("submit"),b("form",g[0]).submit(function(a){y(a);return!1}));c=[];t=b("#"+a.sAddNewRowOkButtonId,g);if(0==t.length){if(null==a.oAddNewRowOkButtonOptions.text||""==a.oAddNewRowOkButtonOptions.text)a.oAddNewRowOkButtonOptions.text=
"Ok";a.oAddNewRowOkButtonOptions.click=y;a.oAddNewRowOkButtonOptions.id=a.sAddNewRowOkButtonId;c.push(a.oAddNewRowOkButtonOptions)}else t.click(y);u=b("#"+a.sAddNewRowCancelButtonId);if(0==u.length){if(null==a.oAddNewRowCancelButtonOptions.text||""==a.oAddNewRowCancelButtonOptions.text)a.oAddNewRowCancelButtonOptions.text="Cancel";a.oAddNewRowCancelButtonOptions.click=G;a.oAddNewRowCancelButtonOptions.id=a.sAddNewRowCancelButtonId;c.push(a.oAddNewRowCancelButtonOptions)}else u.click(G);0<c.length&&
g.dialog("option","buttons",c);t=b("#"+a.sAddNewRowOkButtonId);u=b("#"+a.sAddNewRowCancelButtonId);null!=a.oAddNewRowFormValidation&&g.validate(a.oAddNewRowFormValidation)}else g=null;p=b("#"+a.sDeleteRowButtonId);0!=p.length?"true"!=p.data("delete-event-attached")&&(p.click(H),p.data("delete-event-attached","true")):p=null;oAddDeleteToolbar=b(a.sAddDeleteToolbarSelector);0!=oAddDeleteToolbar.length&&(null==q&&(""!=a.sAddNewRowButtonId&&null!=g)&&(oAddDeleteToolbar.append("<button id='"+a.sAddNewRowButtonId+
"' class='add_row'>Add</button>"),q=b("#"+a.sAddNewRowButtonId),q.click(function(){g.dialog("open")})),null==p&&""!=a.sDeleteRowButtonId&&(oAddDeleteToolbar.append("<button id='"+a.sDeleteRowButtonId+"' class='delete_row'>Delete</button>"),p=b("#"+a.sDeleteRowButtonId),p.click(H)));null!=p&&(null!=a.oDeleteRowButtonOptions&&p.button(a.oDeleteRowButtonOptions),z());null!=q&&null!=a.oAddNewRowButtonOptions&&q.button(a.oAddNewRowButtonOptions);null!=t&&null!=a.oAddNewRowOkButtonOptions&&t.button(a.oAddNewRowOkButtonOptions);
null!=u&&null!=a.oAddNewRowCancelButtonOptions&&u.button(a.oAddNewRowCancelButtonOptions);b(".table-action-deletelink",d).live("click",K);a.bUseKeyTable?d.keys.event.focus(null,null,function(a,b,c){}):b("tbody",d).click(function(c){b(c.target.parentNode).hasClass(a.sSelectedRowClass)?(b(c.target.parentNode).removeClass(a.sSelectedRowClass),null!=p&&z()):(b(d.fnSettings().aoData).each(function(){b(this.nTr).removeClass(a.sSelectedRowClass)}),b(c.target.parentNode).addClass(a.sSelectedRowClass),null!=
p&&(null!=a.oDeleteRowButtonOptions?p.button("option","disabled",!1):p.removeAttr("disabled")))});if(null!=a.aoTableActions)for(var f=0;f<a.aoTableActions.length;f++){var h=b.extend({sType:"edit"},a.aoTableActions[f]),c=h.sAction,l=b("#form"+c);if(0!=l.length){var m={autoOpen:!1,modal:!0},m=b.extend({},h.oFormOptions,m);l.dialog(m);l.data("action-options",h);h=b(".table-action-"+c);0!=h.length&&h.live("click",function(){var c=this.className.split(/\s+/),d="",e="";for(f=0;f<c.length;f++)-1<c[f].indexOf("table-action-")&&
(e=c[f].replace("table-action-",""),d="#form"+e);""==d&&a.fnShowError("Cannot find a form with an id "+d+" that should be associated to the action - "+e,e);"edit"==b(d).data("action-options").sType&&(c=b(this).parents("tr")[0],N(l,c));b(l).dialog("open")});l.submit(function(a){O(this);return!1});h=[];c=b("#form"+c+"Cancel",l);0!=c.length&&(h.push(c),c.click(function(){var a=b(this).parents("form")[0];b(a).validate().resetForm();b(a)[0].reset();b(".error",b(a)).html("");b(".error",b(a)).hide();b(a).dialog("close")}));
b("button",l).button()}}})}})(jQuery);
